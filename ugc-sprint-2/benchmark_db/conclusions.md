## Выбор хранилища

Сравнивались MongoDB и Clickhouse. 
Условия замеров:
1. Кластеры базы данных развернуты в облачной платформе Яндекс.Облако. В папках проекта представлены конфигурации, 
для развертывания c помощью docker-compose, но в связи со значительными требованиями к ресурсам для данных кластеров 
предъявляются значительные требования к объему оперативной памями (для mongodb не менее 12 ГБ) или производительности 
процессора (сжатие и объединение данных в Clickhouse).
2. Базы данных заполнены сгенерированными тестовыми данными. Объем тестовых данных:
  - фильмы в закладках пользователей для 210 000 пользователей, от 0 до 50 фильмов закладках (примерно 5 млн. закладок);
  - лайки фильмов из расчета, что 200 000 пользователей поставили свои лайки от 0 до 99 фильмам (примерно 10 млн. оценок);
  - рецензии на фильмы из расчета, что рецензии оставили 10 000 авторов, каждый автор от 0 до 99 рецензий на различные фильмы, 
  каждая рецензия имеет от 0 до 99 оценок (примерно 500 тыс. рецензий и 25 млн. их оценок).
3. Все запросы к разным таблицам базы данных в ходе замеров выполняются одновременно в асинхронном режиме.
4. Среднее время определялось на основании 1000 уникальных запросов к каждой таблице (коллекции) базы данных согласно 
ожидаемым сценариям использования. 

Результаты замеров среднего времени выполнения запросов на чтение к базам данным, а также информация о топологии баз данных, 
количестве записей в тестовых таблицах и занимаемом месте на диске приведена в файлах 
[clickhouse_benchmark.md](clickhouse_benchmark.md) и [mongodb_benchmark.md](mongodb_benchmark.md).

Для хранилища лайков, рецензий и закладок фильмов на основании замеров выбрана NoSQL база данных MongoDB.

Выбор MongoDB обусловлен следующими причинами:
1. Существенно более высокая скорость выполнения чтения из базы данных (для некоторых запросов в 5-6 раз), 
по сравнению с Сlickhouse. Для некоторых вариантов запросов средние показатели Clickhouse находятся вблизи 
установленного ограничения по времени ответа сервиса 200 мс, а единичные значения выходят за него.
2. Гибкий механизм организации данных в документах MongoDB, в некоторых случаях позволяющий избежать их дублирования
или наоборот использовать дублирование и вложенные документы для увеличения скорости доступа к данным.
3. Мощный механизм работы с полями документа при CRUD, допускающий вставку или удаление значений массивов значений или 
вложенных документов без необходимости внесения изменения в весь документ. 
4. Использование фреймворка агрегации также позволяет добиться ускорения доступа к часто используемым данным и данным 
на основе агрегированных показателей. Для Clickhouse аналогичной функциональности можно добиться используя 
AggregatingMergeTree.

При этом с точки зрения занимаемого места на диске за счет более эффективного сжатия однородных данных в столбцах 
базы данных существенно выигрывает Clickhouse. MongoDB в этом случае предъявляет более высокие требования к 
проектированию модели коллекций и схем документов, для уменьшения занимаемого места на диске.